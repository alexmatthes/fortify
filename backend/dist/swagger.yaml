openapi: 3.0.0
info:
    title: Fortify API
    description: API documentation for the Fortify drumming practice application.
    version: 1.0.0
    contact:
        name: API Support
        email: support@fortify.app
servers:
    - url: http://localhost:5000/api
      description: Local Development Server

# ---------------------------------------------------------
# GLOBAL SECURITY
# ---------------------------------------------------------
# This applies Bearer Token Auth to all endpoints by default.
# We will disable it specifically for Login/Signup.
security:
    - bearerAuth: []

# ---------------------------------------------------------
# PATHS (ENDPOINTS)
# ---------------------------------------------------------
paths:
    # --- AUTH ROUTES ---
    /auth/signup:
        post:
            summary: Register a new user
            tags: [Auth]
            security: [] # Disables global security for this route
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/AuthInput'
            responses:
                201:
                    description: User created successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/User'
                400:
                    description: Validation error or Email already in use

    /auth/login:
        post:
            summary: Log in an existing user
            tags: [Auth]
            security: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/AuthInput'
            responses:
                200:
                    description: Login successful
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    token:
                                        type: string
                                        example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
                                    user:
                                        $ref: '#/components/schemas/User'
                401:
                    description: Invalid credentials

    # --- RUDIMENT ROUTES ---
    /rudiments:
        get:
            summary: Get all rudiments
            description: Returns standard rudiments plus the user's custom rudiments.
            tags: [Rudiments]
            responses:
                200:
                    description: List of rudiments
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/Rudiment'
        post:
            summary: Create a custom rudiment
            tags: [Rudiments]
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/RudimentInput'
            responses:
                201:
                    description: Rudiment created
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Rudiment'

    /rudiments/{id}:
        delete:
            summary: Delete a custom rudiment
            tags: [Rudiments]
            parameters:
                - in: path
                  name: id
                  schema:
                      type: string
                  required: true
                  description: The rudiment ID
            responses:
                204:
                    description: Rudiment deleted successfully
                403:
                    description: Cannot delete standard rudiments

    /rudiments/{id}/tempo:
        get:
            summary: Get suggested tempo (Smart Tempo)
            tags: [Rudiments]
            parameters:
                - in: path
                  name: id
                  schema:
                      type: string
                  required: true
            responses:
                200:
                    description: Suggested tempo based on history
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    suggested_tempo:
                                        type: integer
                                        example: 85

    # --- SESSION ROUTES ---
    /sessions:
        get:
            summary: Get practice sessions history
            tags: [Sessions]
            parameters:
                - in: query
                  name: page
                  schema:
                      type: integer
                      default: 1
                - in: query
                  name: limit
                  schema:
                      type: integer
                      default: 20
            responses:
                200:
                    description: Paginated list of sessions
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    sessions:
                                        type: array
                                        items:
                                            $ref: '#/components/schemas/PracticeSession'
                                    pagination:
                                        type: object
                                        properties:
                                            page:
                                                type: integer
                                            limit:
                                                type: integer
                                            total:
                                                type: integer
                                            totalPages:
                                                type: integer

# ---------------------------------------------------------
# REUSABLE COMPONENTS
# ---------------------------------------------------------
components:
    securitySchemes:
        bearerAuth:
            type: http
            scheme: bearer
            bearerFormat: JWT

    schemas:
        # --- INPUT SCHEMAS (For POST bodies) ---
        AuthInput:
            type: object
            required:
                - email
                - password
            properties:
                email:
                    type: string
                    format: email
                    example: drummer@example.com
                password:
                    type: string
                    format: password
                    minLength: 8
                    example: 'paradiddle123'

        RudimentInput:
            type: object
            required:
                - name
            properties:
                name:
                    type: string
                    example: 'Flam Accent'
                description:
                    type: string
                category:
                    type: string
                    example: 'Flam Rudiments'
                tempoIncrement:
                    type: integer
                    default: 2

        # --- MODEL SCHEMAS (Matches Prisma Models) ---
        User:
            type: object
            properties:
                id:
                    type: string
                email:
                    type: string
                    format: email

        Rudiment:
            type: object
            properties:
                id:
                    type: string
                name:
                    type: string
                description:
                    type: string
                category:
                    type: string
                isStandard:
                    type: boolean
                tempoIncrement:
                    type: integer
                difficulty:
                    type: string

        PracticeSession:
            type: object
            properties:
                id:
                    type: string
                date:
                    type: string
                    format: date-time
                duration:
                    type: integer
                    description: Duration in minutes
                tempo:
                    type: integer
                    description: BPM
                quality:
                    type: integer
                    description: Rating 1-4
                rudiment:
                    $ref: '#/components/schemas/Rudiment'
