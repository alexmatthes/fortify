// This block tells Prisma how to connect to your database.
// It gets the URL from your .env file.
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// This block tells Prisma to generate its "translator" (the Prisma Client).
generator client {
  provider = "prisma-client-js"
}

//
// YOUR DATABASE MODELS START HERE
//

// This model will become the "User" table
model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String    // Will be hashed

  // These two lines are "relations". They
  // tell Prisma that one User can have MANY Rudiments
  // and MANY PracticeSessions.
  rudiments Rudiment[]
  sessions  PracticeSession[]
  routines Routine[]
}

// This model will become the "Rudiment" table (for screen3)
model Rudiment {
  id             String   @id @default(cuid())
  name           String
  description    String?
  category       String?
  tempoIncrement Int      @default(2)
  isStandard     Boolean  @default(false)
  
  difficulty     String   @default("Beginner")
  
  // Progression Logic
  parentId       String?
  parent         Rudiment?  @relation("Progression", fields: [parentId], references: [id])
  children       Rudiment[] @relation("Progression")

  userId         String?
  user           User?    @relation(fields: [userId], references: [id])
  
  sessions       PracticeSession[]
  
  routineItems   RoutineItem[] 
}

// This model will become the "PracticeSession" table (for screen2)
model PracticeSession {
  id        String   @id @default(cuid())
  date      DateTime @default(now())
  duration  Int      // in minutes
  tempo     Int      // in BPM
  quality   Int      // rating from 1-4

  // This links the session back to its User
  user   User     @relation(fields: [userId], references: [id])
  userId String

  // This links the session to a single Rudiment
  rudiment   Rudiment @relation(fields: [rudimentId], references: [id])
  rudimentId String
}

model Routine {
  id          String        @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime      @default(now())
  
  userId      String
  user        User          @relation(fields: [userId], references: [id])
  
  items       RoutineItem[]
}

model RoutineItem {
  id          String   @id @default(cuid())
  order       Int      // 0, 1, 2... (Position in the playlist)
  duration    Int      // Target duration in minutes
  
  routineId   String
  routine     Routine  @relation(fields: [routineId], references: [id], onDelete: Cascade)
  
  rudimentId  String
  rudiment    Rudiment @relation(fields: [rudimentId], references: [id])
}